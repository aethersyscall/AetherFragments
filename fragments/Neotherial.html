<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>NeoAether | The Vim Dojo</title>
  <style>
    /* 
         * 1. AETHER AMETHYST ENGINE 
         */
    :root {
      --font-ui: 'Inter', system-ui, -apple-system, sans-serif;
      --font-mono: 'JetBrains Mono', 'Fira Code', monospace;

      /* Eclipse (Dark) */
      --bg: #13111B;
      --surface: #1B1824;
      --surface-hover: #252130;
      --element: #252130;
      --border: #2E283B;
      --primary: #EDE8F5;
      --secondary: #9B94A8;

      /* Syntax Accents */
      --kwd: #9580FF;
      /* Keyword */
      --fnc: #FF70B8;
      /* Function */
      --str: #FF9CE6;
      /* String */
      --op: #80FFEA;
      /* Operator */
      --err: #FF70B8;
      --suc: #80FFEA;

      --radius-sm: 8px;
      --radius-md: 16px;
      --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 12px 40px rgba(0, 0, 0, 0.2);
      --trans: all 0.25s cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    [data-theme="bliss"] {
      --bg: #FDF7FF;
      --surface: #F4EBFA;
      --surface-hover: #EADCF5;
      --element: #EADCF5;
      --border: #DCC2F0;
      --primary: #3E3245;
      --secondary: #746880;

      --kwd: #624CAB;
      --fnc: #D1006B;
      --str: #C22085;
      --op: #008B8B;
      --err: #D1006B;
      --suc: #008B8B;
    }

    /* 
         * 2. CORE LAYOUT 
         */
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      background: var(--bg);
      color: var(--primary);
      font-family: var(--font-ui);
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transition: background 0.3s, color 0.3s;
    }

    /* 
         * 3. HEADER & NAV 
         */
    header {
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border);
      background: var(--surface);
      z-index: 10;
    }

    .brand {
      font-weight: 800;
      font-size: 1.25rem;
      letter-spacing: -0.5px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .brand span {
      color: var(--kwd);
    }

    .brand svg {
      width: 24px;
      height: 24px;
      fill: var(--suc);
    }

    .nav-pills {
      display: flex;
      background: var(--element);
      padding: 4px;
      border-radius: var(--radius-sm);
      gap: 4px;
    }

    .nav-item {
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--secondary);
      transition: var(--trans);
      user-select: none;
    }

    .nav-item.active {
      background: var(--bg);
      color: var(--kwd);
      box-shadow: var(--shadow-sm);
    }

    .icon-btn {
      background: transparent;
      border: none;
      color: var(--secondary);
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      display: flex;
      transition: var(--trans);
    }

    .icon-btn:hover {
      background: var(--element);
      color: var(--primary);
    }

    /* 
         * 4. MAIN STAGE 
         */
    main {
      flex: 1;
      position: relative;
      overflow: hidden;
    }

    .view-section {
      position: absolute;
      inset: 0;
      overflow-y: auto;
      padding: 2rem;
      opacity: 0;
      transform: translateY(20px);
      pointer-events: none;
      transition: var(--trans);
    }

    .view-section.active {
      opacity: 1;
      transform: translateY(0);
      pointer-events: all;
    }

    /* 
         * 5. DOJO UI 
         */
    .dojo-center {
      max-width: 600px;
      margin: 4rem auto 0;
      text-align: center;
    }

    .flashcard {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 3rem 2rem;
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }

    .flashcard::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--kwd), var(--fnc));
      opacity: 0.5;
    }

    .prompt-label {
      text-transform: uppercase;
      letter-spacing: 2px;
      font-size: 0.75rem;
      color: var(--secondary);
      margin-bottom: 1.5rem;
      font-weight: 700;
    }

    .prompt-text {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 2.5rem;
      line-height: 1.3;
    }

    .input-viz {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 200px;
      height: 64px;
      background: var(--bg);
      border: 2px solid var(--border);
      border-radius: var(--radius-sm);
      font-family: var(--font-mono);
      font-size: 1.5rem;
      color: var(--str);
      position: relative;
      transition: 0.1s;
    }

    .input-viz.active {
      border-color: var(--kwd);
      box-shadow: 0 0 0 4px rgba(149, 128, 255, 0.1);
    }

    .input-viz.shake {
      animation: shake 0.4s cubic-bezier(.36, .07, .19, .97) both;
      border-color: var(--err);
      color: var(--err);
    }

    .input-viz.pulse {
      animation: pulse 0.3s ease-out;
      border-color: var(--suc);
      color: var(--suc);
    }

    .cursor {
      width: 10px;
      height: 24px;
      background: var(--kwd);
      margin-left: 4px;
      animation: blink 1s infinite;
    }

    .stats-deck {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-top: 2rem;
      font-family: var(--font-mono);
      font-size: 0.9rem;
      color: var(--secondary);
    }

    /* 
         * 6. GRIMOIRE UI (Reference)
         */
    .search-sticky {
      position: sticky;
      top: 0;
      z-index: 5;
      background: var(--bg);
      /* Opaque for scrolling */
      padding-bottom: 1rem;
      margin-bottom: 1rem;
    }

    .search-input {
      width: 100%;
      padding: 1rem 1.25rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--primary);
      font-size: 1rem;
      outline: none;
      transition: var(--trans);
    }

    .search-input:focus {
      border-color: var(--kwd);
      box-shadow: 0 0 0 2px rgba(149, 128, 255, 0.1);
    }

    .grid-masonry {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
      padding-bottom: 4rem;
    }

    .cmd-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 1.25rem;
      transition: transform 0.2s;
      cursor: default;
    }

    .cmd-card:hover {
      transform: translateY(-2px);
      border-color: var(--surface-hover);
    }

    .keys-wrapper {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 0.75rem;
    }

    .key-badge {
      background: var(--element);
      color: var(--kwd);
      font-family: var(--font-mono);
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.85rem;
      font-weight: 700;
      border: 1px solid var(--border);
    }

    .cmd-desc {
      font-size: 0.95rem;
      line-height: 1.5;
      color: var(--secondary);
    }

    .cmd-cat {
      display: inline-block;
      margin-top: 0.75rem;
      font-size: 0.7rem;
      text-transform: uppercase;
      color: var(--fnc);
      opacity: 0.8;
    }

    /* 
         * 7. MOBILE UTILITY BAR
         */
    .mobile-deck {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--surface);
      border-top: 1px solid var(--border);
      padding: 0.5rem;
      display: none;
      /* Flex on mobile */
      gap: 0.5rem;
      justify-content: center;
      z-index: 100;
    }

    .touch-key {
      background: var(--element);
      border: 1px solid var(--border);
      color: var(--primary);
      font-family: var(--font-mono);
      font-size: 0.8rem;
      padding: 0.75rem;
      border-radius: 6px;
      flex: 1;
      text-align: center;
      max-width: 60px;
    }

    .touch-key:active {
      background: var(--kwd);
      color: white;
    }

    /* Hidden Input for Keyboard Trap */
    #trap-input {
      position: absolute;
      opacity: 0;
      top: -1000px;
    }

    /* Animations */
    @keyframes blink {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0;
      }
    }

    @keyframes shake {

      10%,
      90% {
        transform: translate3d(-1px, 0, 0);
      }

      20%,
      80% {
        transform: translate3d(2px, 0, 0);
      }

      30%,
      50%,
      70% {
        transform: translate3d(-4px, 0, 0);
      }

      40%,
      60% {
        transform: translate3d(4px, 0, 0);
      }
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }

      100% {
        transform: scale(1);
      }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .mobile-deck {
        display: flex;
      }

      main {
        padding-bottom: 60px;
      }

      .dojo-center {
        margin-top: 1rem;
        padding: 1rem;
      }

      .grid-masonry {
        grid-template-columns: 1fr;
      }

      .brand span {
        display: none;
      }
    }
  </style>
</head>

<body data-theme="eclipse">

  <!-- HEADER -->
  <header>
    <div class="brand">
      <svg viewBox="0 0 24 24">
        <path d="M2 2L10 2L12 10L14 2L22 2V22H18V12L12 22L6 12V22H2V2Z"></path>
      </svg>
      Neo<span>Aether</span>
    </div>

    <div class="nav-pills">
      <div class="nav-item active" onclick="App.route('dojo')">Dojo</div>
      <div class="nav-item" onclick="App.route('grimoire')">Grimoire</div>
    </div>

    <button class="icon-btn" id="theme-btn" aria-label="Toggle Theme">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="5"></circle>
        <line x1="12" y1="1" x2="12" y2="3"></line>
        <line x1="12" y1="21" x2="12" y2="23"></line>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
        <line x1="1" y1="12" x2="3" y2="12"></line>
        <line x1="21" y1="12" x2="23" y2="12"></line>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
      </svg>
    </button>
  </header>

  <main>
    <!-- DOJO VIEW -->
    <section id="view-dojo" class="view-section active">
      <div class="dojo-center">
        <div class="flashcard">
          <div class="prompt-label">Current Objective</div>
          <div class="prompt-text" id="q-text">Loading...</div>

          <div class="input-viz" id="viz-box" onclick="App.focusTrap()">
            <span id="viz-text"></span>
            <div class="cursor"></div>
          </div>

          <div class="stats-deck">
            <div>STREAK: <span id="stat-streak" style="color: var(--kwd); font-weight: bold;">0</span></div>
            <div>BEST: <span id="stat-best">0</span></div>
          </div>
        </div>
        <p style="margin-top: 2rem; color: var(--secondary); font-size: 0.8rem;">
          Type the command. Keys are captured automatically.<br>
          Tap box to open keyboard on mobile.
        </p>
      </div>
    </section>

    <!-- GRIMOIRE VIEW -->
    <section id="view-grimoire" class="view-section">
      <div class="search-sticky">
        <input type="text" class="search-input" id="g-search" placeholder="Search commands, modes, or descriptions...">
      </div>
      <div class="grid-masonry" id="g-grid">
        <!-- Injected via JS -->
      </div>
    </section>
  </main>

  <!-- Mobile Virtual Keys -->
  <div class="mobile-deck">
    <button class="touch-key" onclick="App.virtualKey('Escape')">ESC</button>
    <button class="touch-key" onclick="App.virtualKey('Control')">CTRL</button>
    <button class="touch-key" onclick="App.virtualKey(':')">:</button>
    <button class="touch-key" onclick="App.virtualKey('/')">/</button>
    <button class="touch-key" onclick="App.toggleKeyboard()">KB</button>
  </div>

  <!-- Hidden Trap -->
  <input type="text" id="trap-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">

  <script>
    /**
     * NEOAETHER CORE v2.0
     * "Inhumanly Skilled" implementation of a VIM learning engine.
     */

    // --- 1. THE DATASET (Massive) ---
    const DB = [
      // NAVIGATION (Basic)
      {k: 'h', d: 'Move cursor left', c: 'Nav'},
      {k: 'j', d: 'Move cursor down', c: 'Nav'},
      {k: 'k', d: 'Move cursor up', c: 'Nav'},
      {k: 'l', d: 'Move cursor right', c: 'Nav'},
      {k: 'w', d: 'Jump to start of next word', c: 'Nav'},
      {k: 'W', d: 'Jump to next WORD (whitespace separated)', c: 'Nav'},
      {k: 'b', d: 'Jump backwards to start of word', c: 'Nav'},
      {k: 'B', d: 'Jump backwards to start of WORD', c: 'Nav'},
      {k: 'e', d: 'Jump to end of word', c: 'Nav'},
      {k: 'E', d: 'Jump to end of WORD', c: 'Nav'},
      {k: 'ge', d: 'Jump backwards to end of word', c: 'Nav'},

      // NAVIGATION (Line/Screen)
      {k: '0', d: 'Jump to start of line', c: 'Nav'},
      {k: '^', d: 'Jump to first non-blank character of line', c: 'Nav'},
      {k: '$', d: 'Jump to end of line', c: 'Nav'},
      {k: 'gg', d: 'Go to first line of file', c: 'Nav'},
      {k: 'G', d: 'Go to last line of file', c: 'Nav'},
      {k: ':', d: 'Go to line number (e.g. :10)', c: 'Nav'},
      {k: 'Ctrl+u', d: 'Scroll up half screen', c: 'Nav'},
      {k: 'Ctrl+d', d: 'Scroll down half screen', c: 'Nav'},
      {k: 'Ctrl+b', d: 'Scroll up full screen', c: 'Nav'},
      {k: 'Ctrl+f', d: 'Scroll down full screen', c: 'Nav'},
      {k: 'H', d: 'Move to Top of screen (High)', c: 'Nav'},
      {k: 'M', d: 'Move to Middle of screen', c: 'Nav'},
      {k: 'L', d: 'Move to Bottom of screen (Low)', c: 'Nav'},
      {k: '%', d: 'Jump to matching bracket pair', c: 'Nav'},
      {k: '}', d: 'Jump to next paragraph', c: 'Nav'},
      {k: '{', d: 'Jump to previous paragraph', c: 'Nav'},

      // EDITING (Insert)
      {k: 'i', d: 'Insert before cursor', c: 'Edit'},
      {k: 'I', d: 'Insert at start of line', c: 'Edit'},
      {k: 'a', d: 'Append after cursor', c: 'Edit'},
      {k: 'A', d: 'Append at end of line', c: 'Edit'},
      {k: 'o', d: 'Open new line below', c: 'Edit'},
      {k: 'O', d: 'Open new line above', c: 'Edit'},
      {k: 's', d: 'Delete char and insert', c: 'Edit'},
      {k: 'S', d: 'Delete line and insert', c: 'Edit'},

      // EDITING (Delete/Change)
      {k: 'x', d: 'Delete character under cursor', c: 'Edit'},
      {k: 'X', d: 'Delete character before cursor', c: 'Edit'},
      {k: 'dd', d: 'Delete (cut) current line', c: 'Edit'},
      {k: 'D', d: 'Delete to end of line', c: 'Edit'},
      {k: 'dw', d: 'Delete word', c: 'Edit'},
      {k: 'daw', d: 'Delete "all" word (including space)', c: 'Edit'},
      {k: 'ciw', d: 'Change inside word', c: 'Edit'},
      {k: 'caw', d: 'Change "all" word', c: 'Edit'},
      {k: 'cw', d: 'Change word', c: 'Edit'},
      {k: 'cc', d: 'Change line', c: 'Edit'},
      {k: 'C', d: 'Change to end of line', c: 'Edit'},
      {k: 'r', d: 'Replace single character', c: 'Edit'},
      {k: 'R', d: 'Enter Replace mode', c: 'Edit'},
      {k: 'J', d: 'Join current line with next', c: 'Edit'},
      {k: 'u', d: 'Undo', c: 'Edit'},
      {k: 'Ctrl+r', d: 'Redo', c: 'Edit'},
      {k: '.', d: 'Repeat last command', c: 'Edit'},

      // YANK & PUT
      {k: 'yy', d: 'Yank (copy) line', c: 'Clip'},
      {k: 'y$', d: 'Yank to end of line', c: 'Clip'},
      {k: 'yw', d: 'Yank word', c: 'Clip'},
      {k: 'p', d: 'Put (paste) after cursor', c: 'Clip'},
      {k: 'P', d: 'Put (paste) before cursor', c: 'Clip'},

      // VISUAL MODE
      {k: 'v', d: 'Start Visual mode (char)', c: 'Visual'},
      {k: 'V', d: 'Start Visual Line mode', c: 'Visual'},
      {k: 'Ctrl+v', d: 'Start Visual Block mode', c: 'Visual'},
      {k: 'gv', d: 'Reselect last visual selection', c: 'Visual'},
      {k: '>', d: 'Indent selection', c: 'Visual'},
      {k: '<', d: 'Outdent selection', c: 'Visual'},
      {k: '=', d: 'Auto-indent selection', c: 'Visual'},
      {k: '~', d: 'Toggle case', c: 'Visual'},

      // SEARCH
      {k: '/', d: 'Search forward', c: 'Search'},
      {k: '?', d: 'Search backward', c: 'Search'},
      {k: 'n', d: 'Next search result', c: 'Search'},
      {k: 'N', d: 'Previous search result', c: 'Search'},
      {k: '*', d: 'Search for word under cursor (fwd)', c: 'Search'},
      {k: '#', d: 'Search for word under cursor (bwd)', c: 'Search'},
      {k: ':noh', d: 'Clear search highlights', c: 'Search'},

      // WINDOWS & TABS
      {k: ':sp', d: 'Horizontal split', c: 'Win'},
      {k: ':vsp', d: 'Vertical split', c: 'Win'},
      {k: 'Ctrl+w h', d: 'Focus window left', c: 'Win'},
      {k: 'Ctrl+w l', d: 'Focus window right', c: 'Win'},
      {k: 'Ctrl+w k', d: 'Focus window up', c: 'Win'},
      {k: 'Ctrl+w j', d: 'Focus window down', c: 'Win'},
      {k: 'Ctrl+w =', d: 'Equalize window sizes', c: 'Win'},
      {k: ':tabnew', d: 'Open new tab', c: 'Win'},
      {k: 'gt', d: 'Go to next tab', c: 'Win'},
      {k: 'gT', d: 'Go to previous tab', c: 'Win'},

      // FILES & SYSTEM
      {k: ':w', d: 'Save file', c: 'Sys'},
      {k: ':q', d: 'Quit', c: 'Sys'},
      {k: ':q!', d: 'Quit without saving', c: 'Sys'},
      {k: ':wq', d: 'Save and quit', c: 'Sys'},
      {k: ':x', d: 'Save and quit', c: 'Sys'},
      {k: 'ZZ', d: 'Save and quit', c: 'Sys'},
      {k: 'ZQ', d: 'Quit without saving', c: 'Sys'},

      // MARKS & MACROS
      {k: 'm[a-z]', d: 'Set local mark (e.g. ma)', c: 'Adv'},
      {k: '`[a-z]', d: 'Jump to mark exact pos', c: 'Adv'},
      {k: "'[a-z]", d: 'Jump to mark line start', c: 'Adv'},
      {k: 'q[a-z]', d: 'Record macro to register', c: 'Adv'},
      {k: 'q', d: 'Stop recording', c: 'Adv'},
      {k: '@[a-z]', d: 'Replay macro', c: 'Adv'},
      {k: '@@', d: 'Replay last macro', c: 'Adv'}
    ];

    // --- 2. APP LOGIC ---
    const App = {
      state: {
        view: 'dojo',
        theme: 'eclipse',
        streak: 0,
        best: 0,
        currentCard: null,
        input: ''
      },

      els: {
        trap: document.getElementById('trap-input'),
        vizBox: document.getElementById('viz-box'),
        vizText: document.getElementById('viz-text'),
        qText: document.getElementById('q-text'),
        gGrid: document.getElementById('g-grid')
      },

      init() {
        this.loadState();
        this.renderGrimoire();
        this.nextCard();
        this.bindEvents();
        this.applyTheme();
      },

      // Navigation
      route(view) {
        this.state.view = view;
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.getElementById(`view-${view}`).classList.add('active');

        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        const navIndex = view === 'dojo' ? 0 : 1;
        document.querySelectorAll('.nav-item')[navIndex].classList.add('active');

        // If going to dojo, focus the trap
        if (view === 'dojo') this.focusTrap();
      },

      // Theme Engine
      toggleTheme() {
        this.state.theme = this.state.theme === 'eclipse' ? 'bliss' : 'eclipse';
        this.applyTheme();
        this.saveState();
      },

      applyTheme() {
        document.body.setAttribute('data-theme', this.state.theme);
      },

      // Dojo Logic
      nextCard() {
        const idx = Math.floor(Math.random() * DB.length);
        this.state.currentCard = DB[idx];
        this.state.input = '';
        this.renderDojo();
      },

      renderDojo() {
        this.els.qText.innerText = this.state.currentCard.d;
        this.els.vizText.innerText = '';
        this.els.vizBox.className = 'input-viz active'; // Reset animations
      },

      handleInput(key) {
        if (this.state.view !== 'dojo') return;

        // Handle special keys mapping
        if (key === 'Escape') this.state.input = '';
        else if (key === 'Backspace') this.state.input = this.state.input.slice(0, -1);
        else if (key.length === 1) this.state.input += key;

        // Special: handle Control modifier visually or strictly? 
        // For this demo, we assume the user types "Ctrl+w" as separate logic if captured properly
        // But simplistically, we just match string sequences for the prototype.

        this.els.vizText.innerText = this.state.input;
        this.checkAnswer();
      },

      checkAnswer() {
        const target = this.state.currentCard.k;
        const input = this.state.input;

        // Normalize checks (handle C-u etc)
        // Real vim captures ctrl codes, here we are simulating string matching for learning
        // If target has "Ctrl+", we might need special handling logic. 
        // For simplicity in this HTML version, we treat exact string matches or special handling.

        // Allow "Ctrl+u" to be typed as inputting chars if virtual, 
        // but real keyboard sends different codes. 
        // Strategy: If target contains "Ctrl+", checking is loose or requires virtual buttons.

        if (input === target) {
          this.success();
        } else if (!target.startsWith(input)) {
          this.fail();
        }
      },

      success() {
        this.state.streak++;
        if (this.state.streak > this.state.best) this.state.best = this.state.streak;

        document.getElementById('stat-streak').innerText = this.state.streak;
        document.getElementById('stat-best').innerText = this.state.best;

        this.els.vizBox.classList.add('pulse');
        this.els.vizBox.style.borderColor = 'var(--suc)';

        setTimeout(() => {
          this.nextCard();
        }, 400);
      },

      fail() {
        this.state.streak = 0;
        document.getElementById('stat-streak').innerText = 0;
        this.els.vizBox.classList.add('shake');

        // Show Correct Answer briefly
        const original = this.els.qText.innerText;
        this.els.qText.innerHTML = `<span style="color:var(--err)">Expected: ${this.state.currentCard.k}</span>`;

        setTimeout(() => {
          this.els.qText.innerText = original;
          this.state.input = '';
          this.renderDojo();
        }, 1000);
      },

      // Mobile & Keyboard Handling
      bindEvents() {
        // Physical Keyboard
        document.addEventListener('keydown', (e) => {
          if (this.state.view !== 'dojo') return;

          // Ignore modifiers by themselves
          if (['Control', 'Shift', 'Alt', 'Meta'].includes(e.key)) return;

          // Prevent browser defaults for specific vim keys
          if (e.key === '/') e.preventDefault();
          if (e.ctrlKey && ['u', 'd', 'f', 'b', 'r', 'w'].includes(e.key)) {
            e.preventDefault();
            this.handleInput(`Ctrl+${e.key}`);
            return;
          }

          this.handleInput(e.key);
          this.focusTrap();
        });

        // Theme Toggle
        document.getElementById('theme-btn').addEventListener('click', () => this.toggleTheme());

        // Search Grimoire
        document.getElementById('g-search').addEventListener('input', (e) => {
          this.renderGrimoire(e.target.value);
        });
      },

      focusTrap() {
        this.els.trap.focus();
        this.els.vizBox.classList.add('active');
      },

      toggleKeyboard() {
        this.focusTrap();
      },

      virtualKey(k) {
        // Simulate key press
        if (k === 'Control') {
          // Start chord
          this.state.input += 'Ctrl+';
          this.els.vizText.innerText = this.state.input;
        } else {
          this.handleInput(k);
        }
      },

      // Grimoire Renderer
      renderGrimoire(filter = '') {
        const f = filter.toLowerCase();
        const matches = DB.filter(i =>
          i.d.toLowerCase().includes(f) ||
          i.k.toLowerCase().includes(f) ||
          i.c.toLowerCase().includes(f)
        );

        this.els.gGrid.innerHTML = matches.map(item => `
                    <div class="cmd-card">
                        <div class="keys-wrapper">
                            ${this.formatKey(item.k)}
                        </div>
                        <div class="cmd-desc">${item.d}</div>
                        <span class="cmd-cat">${item.c}</span>
                    </div>
                `).join('');
      },

      formatKey(k) {
        // Split logic for aesthetics? 
        return `<span class="key-badge">${k}</span>`;
      },

      // Persistence
      saveState() {
        localStorage.setItem('neoaether_v2', JSON.stringify({
          theme: this.state.theme,
          best: this.state.best
        }));
      },

      loadState() {
        const raw = localStorage.getItem('neoaether_v2');
        if (raw) {
          const d = JSON.parse(raw);
          this.state.theme = d.theme;
          this.state.best = d.best || 0;
          document.getElementById('stat-best').innerText = this.state.best;
        }
      }
    };

    // Ignite
    App.init();

  </script>
</body>

</html>
