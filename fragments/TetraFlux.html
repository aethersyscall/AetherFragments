<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>TetraFlux // Aether</title>
  <meta name="theme-color" content="#13111B">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link
    href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500;800&family=Outfit:wght@300;600;900&display=swap"
    rel="stylesheet">
  <script src="https://unpkg.com/@phosphor-icons/web"></script>

  <style>
    :root {
      /* AETHER AMETHYST: ECLIPSE PALETTE */
      --bg-deep: #13111B;   /* The Void */
      --bg-surface: #1B1824; /* Panels */
      --bg-element: #252130; /* Input/Cards */
      --bg-active: #2F2942;  /* Highlights */
      
      --fg-primary: #EDE8F5; /* White Lilac */
      --fg-secondary: #9B94A8; /* Muted Lavender */
      
      --syn-keyword: #9580FF; /* Logic (Blue-Violet) */
      --syn-function: #FF70B8; /* Action (Neon Pink) */
      --syn-type: #D2A8FF;    /* Structure (Soft Purple) */
      --syn-string: #FF9CE6;  /* Content (Rose) */
      --syn-number: #C26BFF;  /* Math (Vivid Violet) */
      --syn-operator: #80FFEA; /* Flow (Cyan) */
      
      --border: #2E283B;
      --glow: rgba(149, 128, 255, 0.25);
      --radius: 12px;
    }

    * {
      box-sizing: border-box;
      touch-action: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      padding: 0;
      background: var(--bg-deep);
      color: var(--fg-primary);
      font-family: 'Outfit', sans-serif;
      height: 100vh;
      height: 100dvh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    #game-container {
      position: relative;
      width: 100%;
      max-width: 550px;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 20px;
      padding-bottom: max(20px, env(safe-area-inset-bottom));
    }

    /* --- HUD --- */
    .hud {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      margin-bottom: 16px;
      flex-shrink: 0;
      padding: 0 4px;
    }

    .score-block {
      display: flex;
      flex-direction: column;
    }

    .label {
      font-size: 0.7rem;
      color: var(--fg-secondary);
      font-weight: 600;
      letter-spacing: 2px;
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.75rem;
      font-weight: 800;
      color: var(--fg-primary);
      line-height: 1;
      text-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
    }

    .value.highlight {
      color: var(--syn-function);
      text-shadow: 0 0 15px rgba(255, 112, 184, 0.4);
    }

    /* --- CANVAS --- */
    .canvas-wrapper {
      position: relative;
      flex: 1;
      background: var(--bg-surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
      min-height: 0;
      transition: border-color 0.3s;
    }
    
    .canvas-wrapper.active-game {
        border-color: var(--syn-keyword);
        box-shadow: 0 0 30px var(--glow);
    }

    canvas {
      display: block;
      width: 100%;
      height: 100%;
    }

    /* --- CONTROLS --- */
    .controls-area {
      margin-top: 20px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      flex-shrink: 0;
      height: 150px;
    }

    .btn-ctrl {
      background: var(--bg-element);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--fg-secondary);
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.1s ease;
      position: relative;
      overflow: hidden;
    }

    /* D-Pad Layout */
    #btn-left { grid-column: 1; grid-row: 2; border-radius: 12px 4px 4px 12px; }
    #btn-down { grid-column: 2; grid-row: 2; border-radius: 4px; }
    #btn-right { grid-column: 3; grid-row: 2; border-radius: 4px 12px 12px 4px; }
    #btn-rot { grid-column: 2; grid-row: 1; border-radius: 12px 12px 4px 4px; color: var(--syn-keyword); }

    /* Big Action Button */
    #btn-drop {
      grid-column: 4;
      grid-row: 1 / span 2;
      background: linear-gradient(135deg, var(--bg-active), var(--bg-element));
      color: var(--syn-function);
      border-color: var(--syn-function);
      box-shadow: 0 0 15px rgba(255, 112, 184, 0.1);
      font-weight: 800;
      font-size: 1rem;
      flex-direction: column;
      gap: 4px;
    }

    .btn-ctrl:active {
      transform: scale(0.96);
      background: var(--bg-active);
      color: var(--fg-primary);
      border-color: var(--fg-primary);
    }

    #btn-drop:active {
        background: var(--syn-function);
        color: var(--bg-deep);
        box-shadow: 0 0 20px var(--syn-function);
    }

    /* --- OVERLAYS --- */
    .overlay {
      position: absolute;
      inset: 0;
      background: rgba(19, 17, 27, 0.85);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
    }

    .overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    h1 {
      font-size: 3.5rem;
      font-weight: 900;
      margin: 0;
      letter-spacing: -2px;
      /* Gradient Text */
      background: linear-gradient(135deg, var(--syn-keyword), var(--syn-function));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-align: center;
      line-height: 0.9;
      filter: drop-shadow(0 0 20px rgba(149, 128, 255, 0.3));
    }

    .subtitle {
      color: var(--fg-secondary);
      margin: 15px 0 40px;
      font-size: 1rem;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .menu-btn {
      background: linear-gradient(135deg, var(--syn-function), var(--syn-keyword));
      color: #fff;
      border: none;
      padding: 18px 48px;
      border-radius: 99px;
      font-size: 1.1rem;
      font-weight: 700;
      letter-spacing: 1px;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(255, 112, 184, 0.3);
      transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
      font-family: 'Outfit', sans-serif;
    }

    .menu-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 15px 40px rgba(255, 112, 184, 0.5);
    }

    .menu-btn:active {
      transform: scale(0.95);
    }

    .settings-row {
      margin-top: 40px;
      display: flex;
      gap: 24px;
    }

    .icon-toggle {
      font-size: 1.5rem;
      color: var(--fg-secondary);
      cursor: pointer;
      transition: all 0.2s;
      padding: 12px;
      background: var(--bg-element);
      border: 1px solid var(--border);
      border-radius: 50%;
    }

    .icon-toggle.on {
      color: var(--bg-deep);
      background: var(--syn-operator);
      border-color: var(--syn-operator);
      box-shadow: 0 0 15px rgba(128, 255, 234, 0.4);
    }

    /* Desktop specific */
    @media (min-width: 800px) {
      .controls-area {
        display: none;
      }

      .canvas-wrapper {
        border-width: 1px;
      }

      #game-container {
        padding: 40px;
        max-width: 600px;
      }
    }
  </style>
</head>

<body>

  <div id="game-container">

    <!-- HUD -->
    <div class="hud">
      <div class="score-block">
        <div class="label">Current Score</div>
        <div class="value" id="score">0</div>
      </div>
      <div class="score-block" style="align-items: flex-end;">
        <div class="label">High Score</div>
        <div class="value highlight" id="high-score">0</div>
      </div>
    </div>

    <!-- CANVAS -->
    <div class="canvas-wrapper" id="wrapper">
      <canvas id="gameCanvas"></canvas>

      <!-- START SCREEN -->
      <div id="start-screen" class="overlay active">
        <h1>TETRA<br>FLUX</h1>
        <p class="subtitle">Aether Environment</p>
        <button class="menu-btn" onclick="Game.start()">INITIALIZE</button>
        <div class="settings-row">
          <i class="ph-fill ph-speaker-high icon-toggle on" id="btn-sfx" onclick="AudioSys.toggle()"></i>
          <i class="ph-fill ph-vibrate icon-toggle on" id="btn-vib" onclick="Game.toggleVib()"></i>
        </div>
      </div>

      <!-- GAME OVER -->
      <div id="game-over" class="overlay">
        <h1 style="background: var(--syn-function); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 20px rgba(255, 112, 184, 0.4));">SYSTEM<br>HALTED</h1>
        <p class="subtitle">Stack Overflow Detected</p>
        <div class="value" id="final-score" style="margin-bottom:30px; font-size:2.5rem;">0</div>
        <button class="menu-btn" onclick="Game.start()">REBOOT</button>
      </div>
    </div>

    <!-- MOBILE CONTROLS -->
    <div class="controls-area">
      <button class="btn-ctrl" id="btn-rot" onclick="Game.input('rotate')"><i
          class="ph-bold ph-arrow-clockwise"></i></button>
      <button class="btn-ctrl" id="btn-left" onclick="Game.input('left')"><i class="ph-bold ph-caret-left"></i></button>
      <button class="btn-ctrl" id="btn-down" onclick="Game.input('down')"><i class="ph-bold ph-caret-down"></i></button>
      <button class="btn-ctrl" id="btn-right" onclick="Game.input('right')"><i
          class="ph-bold ph-caret-right"></i></button>
      <button class="btn-ctrl" id="btn-drop" onclick="Game.input('drop')">
        <i class="ph-bold ph-arrow-fat-line-down" style="font-size: 1.8rem"></i>
        <span style="font-size:0.6rem; font-weight:800; opacity:0.8; letter-spacing: 1px;">DROP</span>
      </button>
    </div>

  </div>

  <script>
    /**
     * TETRA FLUX // AETHER VERSION
     * Adjusted Colors and Input Handling
     */

    // --- AUDIO SYSTEM ---
    const AudioSys = {
      ctx: null,
      enabled: true,
      init() {
        window.AudioContext = window.AudioContext || window.webkitAudioContext;
        this.ctx = new AudioContext();
      },
      toggle() {
        this.enabled = !this.enabled;
        document.getElementById('btn-sfx').classList.toggle('on', this.enabled);
      },
      play(type) {
        if (!this.enabled || !this.ctx) return;
        if (this.ctx.state === 'suspended') this.ctx.resume();
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        osc.connect(gain);
        gain.connect(this.ctx.destination);
        const now = this.ctx.currentTime;

        // Sound Design tweaked for "Glass/Crystal" vibe
        switch (type) {
          case 'move':
            osc.type = 'triangle'; osc.frequency.setValueAtTime(300, now);
            gain.gain.setValueAtTime(0.03, now); gain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
            osc.start(now); osc.stop(now + 0.05); break;
          case 'rotate':
            osc.type = 'sine'; osc.frequency.setValueAtTime(600, now);
            gain.gain.setValueAtTime(0.05, now); gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
            osc.start(now); osc.stop(now + 0.1); break;
          case 'drop':
            osc.type = 'triangle'; osc.frequency.setValueAtTime(150, now); osc.frequency.linearRampToValueAtTime(50, now + 0.15);
            gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.15);
            osc.start(now); osc.stop(now + 0.15); break;
          case 'clear':
            // Chord for clear
            [523.25, 659.25, 783.99, 1046.50].forEach((freq, i) => {
              const o = this.ctx.createOscillator(); const g = this.ctx.createGain();
              o.connect(g); g.connect(this.ctx.destination);
              o.type = 'sine'; o.frequency.value = freq;
              g.gain.setValueAtTime(0.05, now + i * 0.04); g.gain.exponentialRampToValueAtTime(0.001, now + i * 0.04 + 0.4);
              o.start(now + i * 0.04); o.stop(now + i * 0.04 + 0.4);
            }); break;
          case 'gameover':
            osc.type = 'sawtooth'; osc.frequency.setValueAtTime(100, now); osc.frequency.exponentialRampToValueAtTime(20, now + 0.8);
            gain.gain.setValueAtTime(0.15, now); gain.gain.linearRampToValueAtTime(0, now + 0.8);
            osc.start(now); osc.stop(now + 0.8); break;
        }
      }
    };

    // --- GAME DATA ---
    const COLS = 10;
    const ROWS = 20;
    
    // AETHER PALETTE MAPPING (No Earth Tones)
    // 0: null
    // 1: Pink (Action)
    // 2: Cyan (Flow)
    // 3: Violet (Logic)
    // 4: White/Lilac (Data)
    // 5: Blue-Violet (Structure)
    // 6: Purple (Deep)
    // 7: Rose (Content)
    const COLORS = [
        null, 
        '#FF70B8', // I
        '#80FFEA', // J
        '#9580FF', // L
        '#EDE8F5', // O
        '#8AADF4', // S
        '#D2A8FF', // T
        '#FF9CE6'  // Z
    ];
    
    const SHAPES = [
      [],
      [[1, 1, 0], [0, 1, 1], [0, 0, 0]], // Z
      [[0, 2, 2], [2, 2, 0], [0, 0, 0]], // S
      [[0, 3, 0], [3, 3, 3], [0, 0, 0]], // T
      [[4, 4], [4, 4]],                  // O
      [[0, 0, 0, 0], [5, 5, 5, 5], [0, 0, 0, 0], [0, 0, 0, 0]], // I
      [[6, 0, 0], [6, 6, 6], [0, 0, 0]], // J
      [[0, 0, 7], [7, 7, 7], [0, 0, 0]]  // L
    ];

    // --- ENGINE ---
    const Game = {
      canvas: document.getElementById('gameCanvas'),
      ctx: null,
      grid: [],
      piece: null,
      score: 0,
      highScore: parseInt(localStorage.getItem('tetra_aether_high') || '0'),
      lastTime: 0,
      dropCounter: 0,
      dropInterval: 1000,
      particles: [],
      shake: 0,
      running: false,
      vibration: true,

      // Viewport Logic
      scale: 20,
      offsetX: 0,
      offsetY: 0,

      init() {
        this.ctx = this.canvas.getContext('2d');
        this.resize();
        window.addEventListener('resize', () => this.resize());

        // --- FIXED INPUT HANDLING ---
        document.addEventListener('keydown', e => {
          if (!this.running) return;
          const k = e.key;

          // PREVENT SCROLLING BUG
          if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' '].includes(k)) {
            e.preventDefault();
          }

          if (k === 'ArrowLeft') this.move(-1);
          else if (k === 'ArrowRight') this.move(1);
          else if (k === 'ArrowDown') this.drop();
          else if (k === 'ArrowUp') this.rotate();
          else if (k === ' ') this.hardDrop();
        });

        document.getElementById('high-score').innerText = this.highScore;
        AudioSys.init();
      },

      resize() {
        const wrapper = document.getElementById('wrapper');
        const w = wrapper.clientWidth;
        const h = wrapper.clientHeight;

        this.canvas.width = w;
        this.canvas.height = h;

        const scaleX = w / COLS;
        const scaleY = h / ROWS;
        this.scale = Math.floor(Math.min(scaleX, scaleY));

        this.offsetX = Math.floor((w - (this.scale * COLS)) / 2);
        this.offsetY = Math.floor((h - (this.scale * ROWS)) / 2);

        if (!this.running && this.ctx) this.draw(); 
      },

      start() {
        this.grid = Array.from({length: ROWS}, () => Array(COLS).fill(0));
        this.score = 0;
        this.updateScore(0);
        this.dropInterval = 1000;
        this.particles = [];
        this.running = true;
        this.spawnPiece();
        document.querySelectorAll('.overlay').forEach(el => el.classList.remove('active'));
        document.getElementById('wrapper').classList.add('active-game');
        if (AudioSys.ctx.state === 'suspended') AudioSys.ctx.resume();
        this.resize();
        this.loop();
      },

      spawnPiece() {
        const type = (Math.random() * 7 | 0) + 1;
        this.piece = {
          matrix: JSON.parse(JSON.stringify(SHAPES[type])), 
          pos: {x: (COLS / 2 | 0) - (SHAPES[type][0].length / 2 | 0), y: 0},
          type: type
        };
        if (this.collide(this.grid, this.piece)) this.gameOver();
      },

      drop() {
        this.piece.pos.y++;
        if (this.collide(this.grid, this.piece)) {
          this.piece.pos.y--;
          this.merge();
          this.spawnPiece();
          this.arenaSweep();
          AudioSys.play('drop');
        }
        this.dropCounter = 0;
      },

      hardDrop() {
        while (!this.collide(this.grid, this.piece)) this.piece.pos.y++;
        this.piece.pos.y--;
        this.merge();
        this.spawnPiece();
        this.arenaSweep();
        this.triggerShake(5);
        AudioSys.play('drop');
      },

      move(dir) {
        this.piece.pos.x += dir;
        if (this.collide(this.grid, this.piece)) this.piece.pos.x -= dir;
        else AudioSys.play('move');
      },

      rotate() {
        const pos = this.piece.pos.x;
        let offset = 1;
        this.rotateMatrix(this.piece.matrix);
        while (this.collide(this.grid, this.piece)) {
          this.piece.pos.x += offset;
          offset = -(offset + (offset > 0 ? 1 : -1));
          if (offset > this.piece.matrix[0].length) {
            this.rotateMatrix(this.piece.matrix, -1);
            this.piece.pos.x = pos;
            return;
          }
        }
        AudioSys.play('rotate');
      },

      rotateMatrix(matrix, dir = 1) {
        for (let y = 0; y < matrix.length; ++y) {
          for (let x = 0; x < y; ++x) {
            [matrix[x][y], matrix[y][x]] = [matrix[y][x], matrix[x][y]];
          }
        }
        if (dir > 0) matrix.forEach(row => row.reverse());
        else matrix.reverse();
      },

      collide(arena, player) {
        const m = player.matrix;
        const o = player.pos;
        for (let y = 0; y < m.length; ++y) {
          for (let x = 0; x < m[y].length; ++x) {
            if (m[y][x] !== 0 && (arena[y + o.y] && arena[y + o.y][x + o.x]) !== 0) return true;
          }
        }
        return false;
      },

      merge() {
        this.piece.matrix.forEach((row, y) => {
          row.forEach((value, x) => {
            if (value !== 0) this.grid[y + this.piece.pos.y][x + this.piece.pos.x] = value;
          });
        });
      },

      arenaSweep() {
        let rowCount = 0;
        outer: for (let y = this.grid.length - 1; y > 0; --y) {
          for (let x = 0; x < this.grid[y].length; ++x) if (this.grid[y][x] === 0) continue outer;
          const row = this.grid.splice(y, 1)[0].fill(0);
          this.grid.unshift(row);
          ++y;
          rowCount++;
          for (let i = 0; i < 10; i++) this.spawnParticle(Math.random() * COLS, y);
        }
        if (rowCount > 0) {
          this.updateScore(rowCount * 10 * rowCount);
          this.dropInterval = Math.max(100, 1000 - (this.score * 0.1));
          AudioSys.play('clear');
          this.triggerShake(rowCount * 3);
          if (this.vibration && navigator.vibrate) navigator.vibrate(50);
        }
      },

      loop(time = 0) {
        if (!this.running) return;
        const deltaTime = time - this.lastTime;
        this.lastTime = time;
        this.dropCounter += deltaTime;
        if (this.dropCounter > this.dropInterval) this.drop();
        this.draw();
        requestAnimationFrame(t => this.loop(t));
      },

      draw() {
        // Base - Aether Void
        this.ctx.fillStyle = '#13111B';
        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

        // Game Board Area Background - Surface
        this.ctx.fillStyle = '#1B1824'; 
        this.ctx.fillRect(this.offsetX, this.offsetY, this.scale * COLS, this.scale * ROWS);

        // Grid Lines (Subtle)
        this.ctx.strokeStyle = '#252130';
        this.ctx.lineWidth = 1;
        this.ctx.beginPath();
        for(let i=0; i<=COLS; i++) {
            this.ctx.moveTo(this.offsetX + i*this.scale, this.offsetY);
            this.ctx.lineTo(this.offsetX + i*this.scale, this.offsetY + ROWS*this.scale);
        }
        for(let i=0; i<=ROWS; i++) {
            this.ctx.moveTo(this.offsetX, this.offsetY + i*this.scale);
            this.ctx.lineTo(this.offsetX + COLS*this.scale, this.offsetY + i*this.scale);
        }
        this.ctx.stroke();

        this.ctx.save();
        if (this.shake > 0) {
          this.ctx.translate((Math.random() - 0.5) * this.shake, (Math.random() - 0.5) * this.shake);
          this.shake *= 0.9;
          if (this.shake < 0.5) this.shake = 0;
        }

        this.drawMatrix(this.grid, {x: 0, y: 0});

        if (this.piece) {
          let ghostPos = {...this.piece.pos};
          while (!this.collide(this.grid, {matrix: this.piece.matrix, pos: ghostPos})) ghostPos.y++;
          ghostPos.y--;

          this.ctx.globalAlpha = 0.2;
          this.drawMatrix(this.piece.matrix, ghostPos, true);
          this.ctx.globalAlpha = 1.0;
          this.drawMatrix(this.piece.matrix, this.piece.pos);
        }

        this.updateParticles();
        this.ctx.restore();

        // Border for game area
        this.ctx.strokeStyle = '#453A59';
        this.ctx.lineWidth = 2;
        this.ctx.strokeRect(this.offsetX, this.offsetY, this.scale * COLS, this.scale * ROWS);
      },

      drawMatrix(matrix, offset, ghost = false) {
        matrix.forEach((row, y) => {
          row.forEach((value, x) => {
            if (value !== 0) {
              const cx = this.offsetX + (x + offset.x) * this.scale;
              const cy = this.offsetY + (y + offset.y) * this.scale;
              const size = this.scale;
              const gap = 2; // Cleaner gap for "Tile" look
              const drawSize = size - gap;

              if (!ghost) {
                // Neon Glow
                this.ctx.shadowBlur = 15;
                this.ctx.shadowColor = COLORS[value];
              }

              this.ctx.fillStyle = COLORS[value];
              this.ctx.fillRect(cx + gap / 2, cy + gap / 2, drawSize, drawSize);

              this.ctx.shadowBlur = 0;
              // Glass Reflection
              this.ctx.fillStyle = 'rgba(255,255,255,0.3)';
              this.ctx.fillRect(cx + gap / 2, cy + gap / 2, drawSize, drawSize / 3);
            }
          });
        });
      },

      spawnParticle(x, y) {
        this.particles.push({
          x: this.offsetX + x * this.scale,
          y: this.offsetY + y * this.scale,
          vx: (Math.random() - 0.5) * 10,
          vy: (Math.random() - 0.5) * 10,
          life: 1.0, color: '#FF70B8' // Neon Pink Sparks
        });
      },

      updateParticles() {
        for (let i = this.particles.length - 1; i >= 0; i--) {
          let p = this.particles[i];
          p.x += p.vx; p.y += p.vy; p.life -= 0.05;
          this.ctx.fillStyle = p.color;
          this.ctx.globalAlpha = p.life;
          this.ctx.fillRect(p.x, p.y, this.scale / 4, this.scale / 4);
          if (p.life <= 0) this.particles.splice(i, 1);
        }
        this.ctx.globalAlpha = 1.0;
      },

      updateScore(val) {
        this.score += val;
        document.getElementById('score').innerText = this.score;
        if (this.score > this.highScore) {
          this.highScore = this.score;
          localStorage.setItem('tetra_aether_high', this.highScore);
          document.getElementById('high-score').innerText = this.highScore;
        }
      },

      gameOver() {
        this.running = false;
        AudioSys.play('gameover');
        document.getElementById('wrapper').classList.remove('active-game');
        document.getElementById('final-score').innerText = this.score;
        document.getElementById('game-over').classList.add('active');
      },

      triggerShake(amount) {this.shake = amount;},

      input(action) {
        if (!this.running) return;
        if (action === 'left') this.move(-1);
        if (action === 'right') this.move(1);
        if (action === 'down') this.drop();
        if (action === 'rotate') this.rotate();
        if (action === 'drop') this.hardDrop();
      },

      toggleVib() {
        this.vibration = !this.vibration;
        document.getElementById('btn-vib').classList.toggle('on', this.vibration);
      }
    };

    window.onload = () => Game.init();
  </script>
</body>

</html>
